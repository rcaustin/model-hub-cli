#!/usr/bin/env bash

set -e

PYTHON="python3"

function print_usage {
  echo "Usage: ./run install | test | /absolute/path/to/file"
}

function run_install {
  #bash setup.sh
  echo "Setting up model-hub-cli environment..."

  # Check if Python is available
  if ! command -v $PYTHON &> /dev/null; then
    echo "ERROR: Python3 is not installed or not in PATH"
    echo "Please install Python 3.8+ and try again"
    exit 1
  fi

  # Install dependencies
  echo "Installing dependencies..."
  pip install -r requirements.txt
  if [ $? -ne 0 ]; then
    echo "ERROR: Failed to install dependencies"
    exit 1
  fi

  echo ""
  echo "âœ… Setup complete!"
  echo "To run the application, use: ./run [command]"
}

function run_test {
  "$PYTHON" -m coverage run -m pytest -v tests/ || true
  "$PYTHON" -m coverage report
}

function run_program {
  local file_path="$1"
  "$PYTHON" -m src.commands.catalogue_runner "$file_path"
}

# ---- Main ----

if [ $# -ne 1 ]; then
  print_usage
  exit 1
fi

ARG="$1"

case "$ARG" in
  install)
    run_install
    ;;
  test)
    run_test
    ;;
  /*)
    run_program "$ARG"
    ;;
  *)
    print_usage
    exit 1
    ;;
esac

